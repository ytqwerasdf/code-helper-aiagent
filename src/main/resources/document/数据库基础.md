### 数据库基础

## SQL基础



常见SQL语句的基础用法

```plsql
DDL：数据定义语言，操作数据库，表

DML：数据操作语言，修改表的字段

DQL：数据查询语言，查询数据

DCL：数据控制语言，操作访问权限和安全级别
```

## DDL： data define language数据定义语言

### 查询数据库

- 查看所有数据库

  ```plsql
  show databases;
  ```

  

- 查看当前数据库

  ```plsql
  select database();
  ```

  

### 创建数据库

- 可以在创建的时候指定字符集

- 也可以判断下是否存在数据库

```plsql
create database [if not exists]数据库名[default charset  字符集] [排序规则]；
```

### 删除数据库

- 危险操作，执行前先判断数据的重要性，或者查看是否已经备份，删库跑路，牢底坐穿

```plsql
drop database [if exists] 数据库名;
```

### 使用数据库

```plsql
use database 数据库名;
```





## 用DDL操作数据表

### 表查询

- 表的查询操作需要进入这个数据库才能操作，比如use test;

### 查询当前数据库有哪些表

```plsql
show tables;
```

### 查看表的结构

```plsql
desc 表名;
```

### 查看表的建表语句，能看到更详细的信息

```plsql
show create table 表名;
```

### 表的数据类型

#### 数值类型

##### 整型：存储的大小区别

- tinyint
- smallint
- mediumint
- int
- bigint

##### 浮点型

- float
- double

#### 文字类型

##### char类型：字符串数据

- char
- varchar

##### blob类型：二进制数据

- tinyblob
- mediumblob
- blob
- longblob

##### text类型：文本数据

- tinytext
- mediumtext
- text
- longtext

#### 日期类型

##### data

- 保存日期信息：YYYY-MM-DD

##### time

- 保存时间信息：HH:MM:SS

##### year

- 保存年份信息：YYYY

##### datetime

- 日期和时间信息混合：YYYY-MM-DD HH:MM:SS

##### timestamp

- 时间戳，类似datatime



### 建表操作：create table

- 最后一个字段不能写逗号

```plsql
create table 表名 （
	字段一 类型 [限制语句][comment 注释],
	字段二 类型 [限制语句][comment 注释],
	字段三 类型 [限制语句][comment 注释],
	...
	字段n 类型 [限制语句]
)  [限制语句][comment 注释];	
```

##### 约束：对表的结构做一些约束，完成有各种复杂功能的表

- 常见约束：
  - NOT NULL-指示某列不能储存NULL值
  - UNIQUE-保证某列的每行必须有唯一的值
  - PRIMARY KEY-  NOT NULL和UNIQUE的结合。确保某列（或两个列多个列的结合）有唯一标识，有助于更容易更快速的找到表中的一个特定记录
  - FOREIGN KEY- 保证一个表中的数据匹配另一个表中的值的参照完整性
  - CHECK- 保证列中的值符合指定的条件
  - DEFAULT- 规定没有给列赋值时的默认值
  - UNSIGNED 规定不区分正负（数字）

#### 实践：学会根据需求创建表

创建一张学生信息表

- id                                   学生id
- stu_num                       学号
- name                            学生姓名
- academy                      学生学院
- class                             学生所在班级
- profession                  专业
- entry_data                  入学日期

```plsql
create table `student`(
	`id` INT auto_increment not null primary key,
	`stu_num` INT not null,
	`name` VARCHAR(20) not null default"ikun",
	`academy` VARCHAR(20) not null,
	`class` INT not null,
	`profession` VARCHAR(20) not null,
	`entry_data` data not null default "2024-1-1"
)comment"这是一张学生表";
```

  

#### 修改表的结构：alter table

操作表的字段

- rename
- add
- modify
- change
- drop

用法示例：

- 重命名表：rename

```plsql
alter table <表名> rename <新表名>;
```

- 添加一列：add

```plsql
alter table tablename add <列名> <类型>;
```

- 修改一列：modify和change

```plsql
alter table tablename modify column <列名> <新列类型>;
```

```plsql
alter table tablename change column <旧列名> <新列名> <新列类型>;
```

- 删除一列：drop

```plsql
alter table tablename drop column <列名>;
```

## DML：data manipulation language数据处理语言

- 可以理解为直接操作表的行
- 分为数据的增删改，注意体会和前面的区别



#### 数据的插入

```plsql
insert into <表名> values (值....);
insert into <表名> (列名.....) values (值....);
```

下面示例向user表中插入：

```plsql
insert into user (username,password,question,question_content) values("cxk","114514","你的名字","我是坤坤");
```

#### 数据的删除

- 如果不带where子句的话是将表的内容全部删除

```plsql
delete from <表名> [where <表达式>];
```

下面的示例删除user表中id为1的一条数据：

```plsql
delete from user where id=1;
```



#### 数据的更改

```plsql
update <表名> set <字段> =<值> [,<字段> =<值>...] [where 表达式]
```

示例

```plsql
update user set username="ikun",password="12306" where id=2;
```



## DQL:数据查询语言

#### 怎么用where子句

- where子句是DML中一个非常重要的部分，它帮助我们完成更加复杂的数据库处理逻辑

where子句运算符

| 运算符  | 描述                                          |
| :------ | --------------------------------------------- |
| =       | 等于                                          |
| <>      | 不等于。在SQL的一些版本中，该操作符可被写成!= |
| >       | 大于                                          |
| <       | 小于                                          |
| >=      | 大于等于                                      |
| <=      | 小于等于                                      |
| BETWEEN | 在某个范围内                                  |
| LIKE    | 搜索某种模式                                  |
| IN      | 指定针对某个列的多个可能值                    |

#### 逻辑运算符

- 我们可以使用逻辑运算符对where子句进行多重限制

1. and
2. or
3. not

示例：查找名称为cxk，id为1的用户

```plsql
select * from user where name="cxk" and id=1;
```

#### 关键字 Order BY：

- 对数字列而言：以数字的大小排序
- 对字母列而言：首先看字母的长度，其次看字母的顺序

1. 对检索的数据进行排序 order by <列名...>;
2. 默认按照列名升序排列 order by <列名...>;
3. 添加desc；按照列名降序排列

下面示例通过id的升序查看user表：

```plsql
select * from user order by id;
```

#### 函数SQL函数

- AVG() - 返回平均值
- COUNT() - 返回行数
- FIRST() - 返回第一个记录的值
- LAST() - 返回最后一个记录的值
- MAX() - 返回最大值
- MIN() - 返回最小值
- SUM() - 返回总和

下面示例获取某一列数据的平均值，其它用法类似

- 需要注意的是，函数需要跟在查询语句之后

```plsql
SELECT AVG(column_name) FROM table_name;
```

#### 数据的查询：select

- 可以通过添加distinct关键字查询无重复字段

```plsql
select * from<表名>;
select <字段> [,<字段>...] from <表名>;
select distinct [<字段>... 或者 *] from <表名>;
```

下面的例子在user按照我们的要求获取信息：

```plsql
##获取user表的所有字段
select * from user;
##只获取user表中的id字段
select id,username from user;
##添加distinct关键字获取无重复的数据
select distinct question from user;
```



## DCL:数据控制语言

权限控制：

- 用于控制数据库的使用权限，可以实现给不同的用户分配不同的权限，下面的语句给所有主机的root用户以所有的权限，且限制其连接密码为123456

```plsql
grant all on *.* to root@'%' identified by '123456' with grant option;
```

- 查询权限

```sql
show grants for '用户名'@'主机名';
```

- 授予权限

```sql
grant 权限列表 on 数据库名.表名 to '用户名'@'主机名';
```

- 撤销权限

```sql
revoke 权限列表 on 数据库名.表名 from '用户名'@'主机名';
```

用户管理：

- 创建用户

```plsql
create user '用户名'@'主机名' identified by '密码';
```

- 修改密码

```plsql
alter user '用户名'@'主机名' identified with mysql_native_password by '密码';
```

- 删除用户

```plsql
drop user '用户名'@'主机名';
```

# 数据库设计

### 三大范式

第一范式(1NF)：每个列都不可以再拆分。
第二范式(2NF)：在第一范式的基础上，非主键列完全依赖于主键，而不能是依赖于主键的一部分。
第三范式(3NF)：在第二范式的基础上，非主键列只依赖于主键，不依赖于其他非主键。

# Mysql底层原理

MySQL 集群的主从复制过程梳理成 3 个阶段：

- **写入 Binlog**：主库写 binlog 日志，提交事务，并更新本地存储数据。
- **同步 Binlog**：把 binlog 复制到所有从库上，每个从库把 binlog 写到暂存日志中。
- **回放 Binlog**：回放 binlog，并更新存储引擎中的数据。

